{"version":3,"file":"OptionCollections-public.shopwp-components.js","mappings":"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","sources":["webpack://shopwpComponents/./src/common/buttons/secondary.jsx","webpack://shopwpComponents/./src/components/storefront/options/option-collections/index.jsx"],"sourcesContent":["/** @jsx jsx */\nimport { jsx, css } from '@emotion/react'\n\nfunction ButtonSecondary({\n\tonClick,\n\tsettings,\n\tisBusy = false,\n\textraCSS = false,\n}) {\n\tconst secondaryButtonCSS = css`\n\t\ttext-transform: capitalize;\n\t\tpadding: 5px 9px;\n\t\tbackground: white;\n\t\tfont-size: 14px;\n\t\tborder: 1px solid silver;\n\t\tappearance: none;\n\t\tfont-family: inherit;\n\n\t\t&:hover {\n\t\t\tcursor: pointer;\n\t\t\topacity: 0.8;\n\t\t}\n\t`\n\n\treturn (\n\t\t<button\n\t\t\tonClick={onClick}\n\t\t\tdisabled={isBusy}\n\t\t\tcss={[secondaryButtonCSS, extraCSS]}>\n\t\t\t{isBusy\n\t\t\t\t? settings.loadMoreCollectionsBusyText\n\t\t\t\t: settings.loadMoreCollectionsText}\n\t\t</button>\n\t)\n}\n\nexport default ButtonSecondary\n","/** @jsx jsx */\nimport { jsx, css } from \"@emotion/react\"\nimport isEmpty from \"lodash/isEmpty\"\nimport union from \"lodash/union\"\nimport has from \"lodash/has\"\nimport to from \"await-to-js\"\nimport { fetchCollections, maybeHandleApiError } from \"Api\"\nimport { shouldOpenOnLoad } from \"Utils\"\nimport ButtonSecondary from \"Common/buttons/secondary\"\nimport { useShopState } from \"../../../shop/_state/hooks\"\n\nconst StorefrontFilterOptionsGroup = wp.element.lazy(() =>\n  import(\n    /* webpackChunkName: 'StorefrontFilterOptionsGroup-public' */ \"../group\"\n  )\n)\n\nconst StorefrontFilterOptionsGroupItems = wp.element.lazy(() =>\n  import(\n    /* webpackChunkName: 'StorefrontFilterOptionsGroupItems-public' */ \"../group-items\"\n  )\n)\n\nfunction OptionCollections({ settings }) {\n  const { useState, useEffect } = wp.element\n  const [isLoadingItems, setIsLoadingItems] = useState(true)\n  const [hasNextPage, setHasNextPage] = useState(false)\n  const [error, setError] = useState(false)\n  const [existingCollections, setExistingCollections] = useState([])\n  const [itemsRaw, setItemsRaw] = useState([])\n  const [filterableValues, setFilterableValues] = useState([])\n  const shouldOpen = shouldOpenOnLoad(settings, \"collections\")\n  const shopState = useShopState()\n\n  function createFilterableValues(resp) {\n    return resp.edges.map((collection) => {\n      return { label: collection.node.title, id: collection.node.id }\n    })\n  }\n\n  async function grabCollections(cursor = false) {\n    setIsLoadingItems(true)\n\n    var params = {\n      query: \"*\",\n      sortKey: \"TITLE\",\n      first: wp.hooks.applyFilters(\"storefront.collectionsToFetch\", 8),\n      reverse: false,\n    }\n\n    if (cursor) {\n      params[\"cursor\"] = cursor\n    }\n\n    const [err, resp] = await to(fetchCollections(params, shopState))\n\n    setIsLoadingItems(false)\n\n    var errorMessage = maybeHandleApiError(err, resp, false)\n\n    if (errorMessage) {\n      setError(errorMessage)\n      return\n    }\n\n    if (resp) {\n      setItemsRaw(resp.edges)\n\n      if (resp.pageInfo.hasNextPage) {\n        setHasNextPage(true)\n      } else {\n        setHasNextPage(false)\n      }\n\n      const finalCollections = wp.hooks.applyFilters(\n        \"storefront.availableCollections\",\n        union(existingCollections.concat(createFilterableValues(resp)))\n      )\n\n      setFilterableValues(finalCollections)\n      setExistingCollections(finalCollections)\n    }\n  }\n\n  function onOpen(isOpen) {\n    if (!isOpen) {\n      return\n    }\n\n    if (existingCollections.length) {\n      setFilterableValues(existingCollections)\n      return\n    }\n\n    grabCollections()\n  }\n\n  async function onLoadMore() {\n    var lastItem = itemsRaw[itemsRaw.length - 1]\n\n    if (lastItem && has(lastItem, \"cursor\")) {\n      grabCollections(lastItem.cursor)\n    }\n  }\n\n  useEffect(() => {\n    onOpen(true)\n  }, [])\n\n  const LoadMoreCSS = css`\n    margin: 10px 0 15px 17px;\n    border-radius: 4px;\n  `\n\n  return (\n    <StorefrontFilterOptionsGroup\n      error={error}\n      onOpen={onOpen}\n      openOnLoad={shouldOpen}\n      isLoadingItems={isLoadingItems}\n      groupType=\"collections\"\n      areFilterOptionsEmpty={isEmpty(filterableValues)}\n      noFilterGroupFoundText={settings.noFilterGroupFoundText}\n      heading={settings.collectionsHeading}\n      items={\n        <>\n          <StorefrontFilterOptionsGroupItems\n            filterOptions={filterableValues}\n            isBusy={isLoadingItems}\n            itemType=\"collections\"\n          />\n          {hasNextPage && (\n            <ButtonSecondary\n              settings={settings}\n              isBusy={isLoadingItems}\n              onClick={onLoadMore}\n              extraCSS={LoadMoreCSS}\n            />\n          )}\n        </>\n      }\n    />\n  )\n}\n\nexport default OptionCollections\n"],"names":["jsx","css","ButtonSecondary","onClick","settings","isBusy","extraCSS","secondaryButtonCSS","loadMoreCollectionsBusyText","loadMoreCollectionsText","isEmpty","union","has","to","fetchCollections","maybeHandleApiError","shouldOpenOnLoad","useShopState","StorefrontFilterOptionsGroup","wp","element","lazy","StorefrontFilterOptionsGroupItems","OptionCollections","useState","useEffect","isLoadingItems","setIsLoadingItems","hasNextPage","setHasNextPage","error","setError","existingCollections","setExistingCollections","itemsRaw","setItemsRaw","filterableValues","setFilterableValues","shouldOpen","shopState","createFilterableValues","resp","edges","map","collection","label","node","title","id","grabCollections","cursor","params","query","sortKey","first","hooks","applyFilters","reverse","err","errorMessage","pageInfo","finalCollections","concat","onOpen","isOpen","length","onLoadMore","lastItem","LoadMoreCSS","noFilterGroupFoundText","collectionsHeading"],"sourceRoot":""}